-- ============================================
-- ANXIIE SCRIPTS - NOCLIP CONTROL
-- Script para GitHub - Controlado pela GUI
-- ============================================

print("üöÄ Iniciando ANXIIE NoClip Script...")
print("üì° Este script √© controlado pela GUI Interface")

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()

-- ========================================
-- VARI√ÅVEIS GLOBAIS (Comunica√ß√£o com GUI)
-- ========================================

_G.noclipToggleAtivo = _G.noclipToggleAtivo or false

-- ========================================
-- CONFIGURA√á√ÉO
-- ========================================

local noclipAtivo = false
local conexaoNoclip = nil
local originalCollisions = {}

-- ========================================
-- FUN√á√ïES AUXILIARES
-- ========================================

local function salvarColisoes()
    originalCollisions = {}
    
    if not character then return end
    
    for _, parte in pairs(character:GetDescendants()) do
        if parte:IsA("BasePart") then
            originalCollisions[parte] = parte.CanCollide
        end
    end
    
    print("üíæ Colis√µes originais salvas:", #originalCollisions, "partes")
end

local function restaurarColisoes()
    if not character then return end
    
    for parte, canCollide in pairs(originalCollisions) do
        if parte and parte.Parent then
            parte.CanCollide = canCollide
        end
    end
    
    print("‚úÖ Colis√µes restauradas")
end

-- ========================================
-- SISTEMA DE NOCLIP
-- ========================================

local function aplicarNoclip()
    if not character then return end
    
    for _, parte in pairs(character:GetDescendants()) do
        if parte:IsA("BasePart") then
            parte.CanCollide = false
        end
    end
end

local function iniciarMonitoramento()
    if conexaoNoclip then
        conexaoNoclip:Disconnect()
    end
    
    print("üîÑ Iniciando monitoramento de NoClip...")
    
    -- Salvar colis√µes originais
    salvarColisoes()
    
    -- Conex√£o para manter NoClip ativo
    conexaoNoclip = RunService.Stepped:Connect(function()
        if noclipAtivo and character and character.Parent then
            aplicarNoclip()
        end
    end)
    
    print("‚úÖ Monitoramento de NoClip ativo")
end

local function pararMonitoramento()
    if conexaoNoclip then
        conexaoNoclip:Disconnect()
        conexaoNoclip = nil
        print("‚èπÔ∏è Monitoramento de NoClip parado")
    end
end

-- ========================================
-- FUN√á√ïES GLOBAIS PARA A GUI
-- ========================================

function _G.ativarNoclipGitHub()
    print("üü¢ Ativando NoClip...")
    noclipAtivo = true
    
    -- Salvar colis√µes originais
    salvarColisoes()
    
    -- Aplicar NoClip imediatamente
    aplicarNoclip()
    
    -- Iniciar monitoramento
    iniciarMonitoramento()
    
    print("‚úÖ NoClip ATIVADO")
    print("üö∂ Voc√™ pode atravessar paredes!")
end

function _G.desativarNoclipGitHub()
    print("üî¥ Desativando NoClip...")
    noclipAtivo = false
    
    -- Parar monitoramento
    pararMonitoramento()
    
    -- Restaurar colis√µes originais
    restaurarColisoes()
    
    print("‚úÖ NoClip DESATIVADO")
    print("üöß Colis√µes restauradas ao normal")
end

-- ========================================
-- EVENTOS DE PERSONAGEM
-- ========================================

-- Reconectar quando o personagem for recarregado
player.CharacterAdded:Connect(function(newCharacter)
    character = newCharacter
    
    print("üîÑ Novo personagem detectado...")
    
    -- Limpar colis√µes salvas
    originalCollisions = {}
    
    -- Se estava ativo, reativar
    if noclipAtivo then
        task.wait(1) -- Esperar o personagem carregar completamente
        print("üîÑ Reativando NoClip ap√≥s respawn...")
        salvarColisoes()
        iniciarMonitoramento()
        aplicarNoclip()
    end
end)

-- ========================================
-- PROTE√á√ÉO CONTRA MUDAN√áAS
-- ========================================

-- Monitorar adi√ß√£o de novas partes ao personagem
if character then
    character.DescendantAdded:Connect(function(descendant)
        if noclipAtivo and descendant:IsA("BasePart") then
            task.wait(0.1) -- Pequeno delay
            descendant.CanCollide = false
            print("üîß Nova parte detectada, NoClip aplicado:", descendant.Name)
        end
    end)
end

-- ========================================
-- AUTO-ATIVA√á√ÉO SE GUI J√Å ESTAVA ATIVA
-- ========================================

-- Se a GUI j√° estava com o toggle ativo quando este script foi carregado
if _G.noclipToggleAtivo then
    print("üîÑ GUI j√° estava ativa, ativando NoClip...")
    task.wait(1)
    _G.ativarNoclipGitHub()
end

-- ========================================
-- INICIALIZA√á√ÉO COMPLETA
-- ========================================

print("‚úÖ ANXIIE NoClip Script carregado com sucesso!")
print("üéÆ Status: " .. (noclipAtivo and "ATIVO" or "INATIVO"))
print("üí° Use a GUI para controlar o NoClip")
print("")
print("Fun√ß√µes dispon√≠veis:")
print("  _G.ativarNoclipGitHub()")
print("  _G.desativarNoclipGitHub()")
print("")
print("‚ö†Ô∏è IMPORTANTE:")
print("  ‚Ä¢ NoClip permite atravessar paredes")
print("  ‚Ä¢ As colis√µes s√£o restauradas ao desativar")
print("  ‚Ä¢ Funciona automaticamente ap√≥s respawn")
