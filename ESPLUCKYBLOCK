-- ESP Lucky Blocks Script - VERS√ÉO OTIMIZADA SEM LAG
-- ESP Lucky Blocks Script - VERS√ÉO CORRIGIDA v3.0
-- by ANXIIE
-- Script hospedado no GitHub - Controlado pela GUI
-- MOSTRA TODOS OS ESP ATIVADOS AO MESMO TEMPO
-- Estrutura: NaturalSpawnLuckyBlock_[Raridade]

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")

local player = Players.LocalPlayer

print("üîç ESP: Iniciando script otimizado...")
print("üîç ESP v3.0: Iniciando script corrigido...")

-- ========================================
-- CONFIGURA√á√ïES DE CORES POR RARIDADE
@@ -23,7 +24,8 @@ local raridadeCores = {
    Epic = Color3.fromRGB(128, 0, 128),          -- Roxo escuro
    Rare = Color3.fromRGB(0, 112, 221),          -- Azul
    Uncommon = Color3.fromRGB(46, 125, 50),      -- Verde
    Common = Color3.fromRGB(158, 158, 158)       -- Cinza
    Common = Color3.fromRGB(158, 158, 158),      -- Cinza
    Divine = Color3.fromRGB(255, 255, 255)       -- Branco brilhante
}

-- Verificar se as vari√°veis globais existem
@@ -37,7 +39,8 @@ if not _G.espRaridades then
        Epic = false,
        Rare = false,
        Uncommon = false,
        Common = false
        Common = false,
        Divine = false
    }
    print("‚ö†Ô∏è ESP: Vari√°veis globais criadas")
end
@@ -51,45 +54,32 @@ folderESP.Name = "ESP_LuckyBlocks_ANXIIE"
folderESP.Parent = Workspace

-- ========================================
-- ARMAZENAMENTO DE CONEX√ïES ESP
-- ARMAZENAMENTO DE ESP
-- ========================================

local espAtivos = {}
local todosESP = {} -- Tabela para armazenar TODOS os ESP ativos

-- ========================================
-- FUN√á√ÉO PARA DETECTAR RARIDADE
-- FUN√á√ÉO PARA DETECTAR RARIDADE DO BLOCO
-- ========================================

local function detectarRaridade(obj)
    if not obj then return nil end

    -- Criar uma string de busca com o nome do objeto e seus parentes
    local searchString = obj.Name
    local nome = obj.Name
    local parentNome = obj.Parent and obj.Parent.Name or ""

    -- Adicionar nome do parent
    if obj.Parent then
        searchString = searchString .. " " .. obj.Parent.Name
        
        -- Adicionar nome do parent do parent
        if obj.Parent.Parent then
            searchString = searchString .. " " .. obj.Parent.Parent.Name
        end
    end
    
    -- Buscar nos children tamb√©m
    for _, child in ipairs(obj:GetChildren()) do
        searchString = searchString .. " " .. child.Name
        if child:IsA("TextLabel") and child.Text then
            searchString = searchString .. " " .. child.Text
    -- Verificar padr√£o: NaturalSpawnLuckyBlock_[Raridade]
    -- Buscar no nome do objeto
    for raridade, _ in pairs(raridadeCores) do
        if nome:find("_" .. raridade) or nome:find(raridade) then
            return raridade
        end
    end

    -- Converter para lowercase para busca case-insensitive
    searchString = searchString:lower()
    
    -- Verificar cada raridade
    -- Buscar no nome do parent
    for raridade, _ in pairs(raridadeCores) do
        if searchString:find(raridade:lower()) then
        if parentNome:find("_" .. raridade) or parentNome:find(raridade) then
            return raridade
        end
    end
@@ -98,52 +88,79 @@ local function detectarRaridade(obj)
end

-- ========================================
-- FUN√á√ÉO PARA CRIAR CONEX√ÉO ESP OTIMIZADA
-- FUN√á√ÉO PARA CRIAR ESP VISUAL
-- ========================================

local function criarConexaoESP(target, raridade, index)
local function criarESP(target, raridade)
    if not target or not target:IsA("BasePart") then return nil end
    
    local char = player.Character
    if not char or not char:FindFirstChild("HumanoidRootPart") then
        return
        return nil
    end

    -- Usar Terrain como adornee (mais otimizado)
    local adorneeLine = Workspace:FindFirstChildOfClass("Terrain") or char:FindFirstChild("HumanoidRootPart")
    if not adorneeLine then return end
    
    -- Criar linha usando CylinderHandleAdornment (muito mais otimizado que Beam)
    local line = Instance.new("CylinderHandleAdornment")
    line.Name = "ESP_Line_" .. raridade .. "_" .. index
    line.AlwaysOnTop = true
    line.Color3 = raridadeCores[raridade]
    line.Radius = 0.15
    line.Transparency = 0.3
    line.Adornee = adorneeLine
    line.Parent = folderESP
    -- Criar Highlight (melhor visualiza√ß√£o)
    local highlight = Instance.new("Highlight")
    highlight.Name = "ESP_Highlight_" .. raridade
    highlight.FillColor = raridadeCores[raridade]
    highlight.OutlineColor = raridadeCores[raridade]
    highlight.FillTransparency = 0.5
    highlight.OutlineTransparency = 0
    highlight.Adornee = target.Parent:IsA("Model") and target.Parent or target
    highlight.Parent = folderESP

    -- Criar BillboardGui para mostrar dist√¢ncia e nome
    local bill = Instance.new("BillboardGui")
    bill.Name = "ESP_Billboard_" .. raridade .. "_" .. index
    bill.Name = "ESP_Billboard_" .. raridade
    bill.Adornee = target
    bill.Size = UDim2.new(0, 120, 0, 50)
    bill.Size = UDim2.new(0, 150, 0, 60)
    bill.StudsOffset = Vector3.new(0, 3, 0)
    bill.AlwaysOnTop = true
    bill.Parent = folderESP

    local txt = Instance.new("TextLabel")
    txt.Size = UDim2.new(1, 0, 1, 0)
    txt.BackgroundTransparency = 1
    txt.TextColor3 = Color3.fromRGB(255, 255, 255)
    txt.TextColor3 = raridadeCores[raridade]
    txt.Font = Enum.Font.GothamBold
    txt.TextSize = 14
    txt.TextStrokeTransparency = 0.5
    txt.TextSize = 16
    txt.TextStrokeTransparency = 0.3
    txt.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
    txt.Parent = bill

    -- Conex√£o RenderStepped para atualizar linha
    -- Criar linha para o bloco
    local adorneeLine = char:FindFirstChild("HumanoidRootPart")
    
    local line = Instance.new("CylinderHandleAdornment")
    line.Name = "ESP_Line_" .. raridade
    line.AlwaysOnTop = true
    line.Color3 = raridadeCores[raridade]
    line.Radius = 0.2
    line.Transparency = 0.3
    line.Adornee = adorneeLine
    line.Parent = folderESP
    
    -- Conex√£o para atualizar posi√ß√£o e dist√¢ncia
    local renderConn
    renderConn = RunService.RenderStepped:Connect(function()
        -- Verificar se ESP est√° ativo para essa raridade
        if _G.espRaridades[raridade] and target and target.Parent and char and char:FindFirstChild("HumanoidRootPart") then
        if not _G.espRaridades[raridade] or not target or not target.Parent then
            -- Limpar ESP quando desativado ou bloco removido
            highlight:Destroy()
            bill:Destroy()
            line:Destroy()
            renderConn:Disconnect()
            
            -- Remover da lista
            for i, esp in ipairs(todosESP) do
                if esp.target == target then
                    table.remove(todosESP, i)
                    break
                end
            end
            return
        end
        
        if char and char:FindFirstChild("HumanoidRootPart") then
            local p1 = char.HumanoidRootPart.Position
            local p2 = target.Position
            local mag = (p2 - p1).Magnitude
@@ -152,25 +169,15 @@ local function criarConexaoESP(target, raridade, index)
            line.Height = mag
            line.CFrame = CFrame.lookAt(p1, p2) * CFrame.new(0, 0, -mag/2)

            -- Atualizar texto com dist√¢ncia
            txt.Text = string.format("%s\n%dm", raridade, math.floor(mag))
        else
            -- Limpar quando desativado ou target removido
            if line then line:Destroy() end
            if bill then bill:Destroy() end
            renderConn:Disconnect()
            
            -- Remover da tabela de ativos
            local key = tostring(target)
            if espAtivos[key] then
                espAtivos[key] = nil
            end
            -- Atualizar texto
            txt.Text = string.format("üéÅ %s\nüìè %dm", raridade, math.floor(mag))
        end
    end)

    return {
        line = line,
        highlight = highlight,
        billboard = bill,
        line = line,
        connection = renderConn,
        target = target,
        raridade = raridade
@@ -184,30 +191,24 @@ end
local function encontrarLuckyBlocks()
    local blocks = {}

    -- Buscar em diferentes locais comuns
    local locaisBusca = {
        Workspace,
        Workspace:FindFirstChild("Map"),
        Workspace:FindFirstChild("LuckyBlocks"),
        Workspace:FindFirstChild("Blocks"),
        Workspace:FindFirstChild("Items"),
        Workspace:FindFirstChild("Game")
    }
    
    for _, localBusca in ipairs(locaisBusca) do
        if localBusca then
            for _, obj in ipairs(localBusca:GetDescendants()) do
                -- Verificar se √© um lucky block (BasePart)
                if obj:IsA("BasePart") and (
                    obj.Name:find("Lucky") or 
                    obj.Name:find("Block") or
                    (obj.Parent and (obj.Parent.Name:find("Lucky") or obj.Parent.Name:find("Block")))
                ) then
                    local raridade = detectarRaridade(obj)
                    if raridade then
                        table.insert(blocks, {block = obj, raridade = raridade})
    -- Buscar em todo o Workspace
    for _, obj in pairs(Workspace:GetDescendants()) do
        if obj:IsA("BasePart") or obj:IsA("MeshPart") then
            local raridade = detectarRaridade(obj)
            
            if raridade then
                -- Verificar se j√° n√£o est√° na lista
                local jaExiste = false
                for _, espInfo in ipairs(todosESP) do
                    if espInfo.target == obj then
                        jaExiste = true
                        break
                    end
                end
                
                if not jaExiste then
                    table.insert(blocks, {block = obj, raridade = raridade})
                end
            end
        end
    end
@@ -216,124 +217,139 @@ local function encontrarLuckyBlocks()
end

-- ========================================
-- FUN√á√ÉO PARA ATUALIZAR ESP
-- FUN√á√ÉO PARA ATUALIZAR TODOS OS ESP
-- ========================================

local function atualizarESP()
    -- Verificar se o character existe
    if not player.Character or not player.Character:FindFirstChild("HumanoidRootPart") then
        return
    end
    
    -- Encontrar todos os lucky blocks
    local luckyBlocks = encontrarLuckyBlocks()
local function atualizarTodosESP()
    -- Encontrar novos blocos
    local novosBlocks = encontrarLuckyBlocks()

    -- Limpar ESP de blocos que n√£o existem mais
    for key, espInfo in pairs(espAtivos) do
        local blockExists = false
    -- Adicionar ESP para blocos que t√™m a raridade ativada
    for _, blockInfo in ipairs(novosBlocks) do
        local raridade = blockInfo.raridade

        for _, blockInfo in ipairs(luckyBlocks) do
            if tostring(blockInfo.block) == key then
                blockExists = true
                break
        if _G.espRaridades[raridade] then
            local esp = criarESP(blockInfo.block, raridade)
            if esp then
                table.insert(todosESP, esp)
                print("‚úÖ ESP adicionado:", raridade)
            end
        end
        
        -- Se o bloco n√£o existe mais ou a raridade foi desativada, remover ESP
        if not blockExists or not _G.espRaridades[espInfo.raridade] then
            if espInfo.line then espInfo.line:Destroy() end
            if espInfo.billboard then espInfo.billboard:Destroy() end
            if espInfo.connection then espInfo.connection:Disconnect() end
            espAtivos[key] = nil
        end
    end
    
    -- Adicionar ESP para novos blocos
    local counter = {}
    for _, blockInfo in ipairs(luckyBlocks) do
        local key = tostring(blockInfo.block)
        local raridade = blockInfo.raridade
        
        -- Contar blocos por raridade
        if not counter[raridade] then
            counter[raridade] = 0
        end
        counter[raridade] = counter[raridade] + 1
        
        -- Se a raridade est√° ativa e o bloco ainda n√£o tem ESP
        if _G.espRaridades[raridade] and not espAtivos[key] then
            local espInfo = criarConexaoESP(blockInfo.block, raridade, counter[raridade])
            if espInfo then
                espAtivos[key] = espInfo
            end
end

-- ========================================
-- FUN√á√ÉO PARA LIMPAR ESP DE UMA RARIDADE
-- ========================================

local function limparESPRaridade(raridade)
    for i = #todosESP, 1, -1 do
        local esp = todosESP[i]
        if esp.raridade == raridade then
            if esp.highlight then esp.highlight:Destroy() end
            if esp.billboard then esp.billboard:Destroy() end
            if esp.line then esp.line:Destroy() end
            if esp.connection then esp.connection:Disconnect() end
            table.remove(todosESP, i)
        end
    end
    print("üóëÔ∏è ESP removido:", raridade)
end

-- ========================================
-- CONEX√ÉO COM A GUI
-- ========================================

-- Fun√ß√£o para ativar ESP de uma raridade espec√≠fica
function _G.ativarESPLuckyBlockGitHub(raridade)
    print("üéØ ESP GitHub: Ativando ESP para " .. raridade)
    _G.espRaridades[raridade] = true
    atualizarESP()
    
    -- Atualizar ESP imediatamente
    atualizarTodosESP()
end

-- Fun√ß√£o para desativar ESP de uma raridade espec√≠fica
function _G.desativarESPLuckyBlockGitHub(raridade)
    print("‚èπÔ∏è ESP GitHub: Desativando ESP para " .. raridade)
    _G.espRaridades[raridade] = false

    -- As conex√µes v√£o se auto-destruir no pr√≥ximo frame do RenderStepped
    -- Limpar ESP dessa raridade
    limparESPRaridade(raridade)
end

-- ========================================
-- LOOP PRINCIPAL (OTIMIZADO)
-- MONITORAMENTO DE NOVOS BLOCOS
-- ========================================

local ultimaAtualizacao = 0
local intervaloAtualizacao = 2 -- Atualizar a cada 2 segundos (otimiza√ß√£o)
-- Atualizar ESP a cada 3 segundos para novos blocos
spawn(function()
    while true do
        wait(3)
        atualizarTodosESP()
    end
end)

RunService.Heartbeat:Connect(function()
    local agora = tick()
-- Monitorar novos objetos adicionados ao Workspace
Workspace.DescendantAdded:Connect(function(obj)
    wait(0.5) -- Aguardar objeto carregar

    -- S√≥ atualizar a lista de blocos a cada X segundos
    if agora - ultimaAtualizacao >= intervaloAtualizacao then
        atualizarESP()
        ultimaAtualizacao = agora
    if obj:IsA("BasePart") or obj:IsA("MeshPart") then
        local raridade = detectarRaridade(obj)
        
        if raridade and _G.espRaridades[raridade] then
            -- Verificar se j√° existe ESP para este objeto
            local jaExiste = false
            for _, esp in ipairs(todosESP) do
                if esp.target == obj then
                    jaExiste = true
                    break
                end
            end
            
            if not jaExiste then
                local esp = criarESP(obj, raridade)
                if esp then
                    table.insert(todosESP, esp)
                    print("üÜï Novo Lucky Block detectado:", raridade)
                end
            end
        end
    end
end)

-- ========================================
-- INICIALIZA√á√ÉO
-- LIMPEZA AO MORRER E REINICIALIZA√á√ÉO
-- ========================================

print("‚úÖ ESP Lucky Blocks carregado (OTIMIZADO - SEM LAG)!")
print("üéÆ Controlado pela GUI ANXIIE")
print("‚ö° Usando CylinderHandleAdornment para performance m√°xima")

-- Primeira atualiza√ß√£o
atualizarESP()

-- Limpar ao morrer e reiniciar ao respawnar
player.CharacterAdded:Connect(function(character)
    -- Limpar todas as conex√µes antigas
    for key, espInfo in pairs(espAtivos) do
        if espInfo.line then espInfo.line:Destroy() end
        if espInfo.billboard then espInfo.billboard:Destroy() end
        if espInfo.connection then espInfo.connection:Disconnect() end
    -- Limpar todos os ESP
    for _, esp in ipairs(todosESP) do
        if esp.highlight then esp.highlight:Destroy() end
        if esp.billboard then esp.billboard:Destroy() end
        if esp.line then esp.line:Destroy() end
        if esp.connection then esp.connection:Disconnect() end
    end
    espAtivos = {}
    todosESP = {}

    -- Limpar folder
    folderESP:ClearAllChildren()

    -- Aguardar character carregar
    character:WaitForChild("HumanoidRootPart")
    task.wait(1)
    wait(2)

    -- Atualizar ESP
    atualizarESP()
    -- Recriar ESP dos blocos que estavam ativos
    atualizarTodosESP()
end)

-- ========================================
-- INICIALIZA√á√ÉO
-- ========================================

print("‚úÖ ESP Lucky Blocks v3.0 carregado!")
print("üéÆ Estrutura detectada: NaturalSpawnLuckyBlock_[Raridade]")
print("üìä Raridades suportadas: Celestial, Legendary, Secret, Cosmic, Mythical, Epic, Rare, Uncommon, Common, Divine")
print("üîç TODOS os ESP ativados aparecer√£o simultaneamente!")

-- Primeira varredura
wait(1)
atualizarTodosESP()
