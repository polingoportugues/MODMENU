-- Script de Teleporte para ROBLOX - SEM ANCORAGEM E SEM QUEDA
-- Posição de destino
local targetPosition = Vector3.new(238.71, 3.23, 138.51)

-- Configurações
local maxTeleportDistance = 150
local flySpeed = 250 -- Velocidade de voo

-- Obter o player local
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local HumanoidRootPart = Character:WaitForChild("HumanoidRootPart")
local Humanoid = Character:WaitForChild("Humanoid")

-- Variáveis de controle
local isFlying = false
local noclipConnection = nil
local antiGravityConnection = nil

-- Função para calcular distância
local function getDistance(pos1, pos2)
    return (pos1 - pos2).Magnitude
end

-- Função de Noclip - Desativa colisão continuamente
local function enableNoclip()
    if noclipConnection then return end
    
    print("NOCLIP ATIVADO - Atravessando paredes")
    
    noclipConnection = RunService.Stepped:Connect(function()
        for _, part in pairs(Character:GetDescendants()) do
            if part:IsA("BasePart") then
                part.CanCollide = false
            end
        end
    end)
end

-- Função para desativar Noclip
local function disableNoclip()
    if noclipConnection then
        noclipConnection:Disconnect()
        noclipConnection = nil
        print("NOCLIP DESATIVADO - Colisão restaurada")
    end
    
    -- Restaurar colisão
    task.wait(0.05)
    for _, part in pairs(Character:GetDescendants()) do
        if part:IsA("BasePart") and part.Name ~= "HumanoidRootPart" then
            part.CanCollide = false
        end
    end
    
    -- HumanoidRootPart com colisão
    if HumanoidRootPart then
        HumanoidRootPart.CanCollide = true
    end
end

-- Função para teleportar
local function teleportPlayer(position)
    -- Teleportar
    HumanoidRootPart.CFrame = CFrame.new(position)
    HumanoidRootPart.Velocity = Vector3.new(0, 0, 0)
    HumanoidRootPart.RotVelocity = Vector3.new(0, 0, 0)
    
    task.wait(0.1)
    
    print("Teleportado para: " .. tostring(position))
end

-- Função de voo CORRIGIDA - SEM QUEDA
local function flyToTarget(targetPos)
    isFlying = true
    
    -- Ativar noclip
    enableNoclip()
    
    print("Iniciando voo para o destino...")
    
    -- Criar BodyVelocity para movimento
    local bodyVelocity = Instance.new("BodyVelocity")
    bodyVelocity.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
    bodyVelocity.Velocity = Vector3.new(0, 0, 0)
    bodyVelocity.Parent = HumanoidRootPart
    
    -- Criar BodyGyro para estabilidade e orientação
    local bodyGyro = Instance.new("BodyGyro")
    bodyGyro.MaxTorque = Vector3.new(9e9, 9e9, 9e9)
    bodyGyro.P = 9000
    bodyGyro.D = 500
    bodyGyro.CFrame = HumanoidRootPart.CFrame
    bodyGyro.Parent = HumanoidRootPart
    
    -- ANTI-GRAVIDADE - Mantém o player no ar
    local bodyPosition = Instance.new("BodyPosition")
    bodyPosition.MaxForce = Vector3.new(0, math.huge, 0) -- Só no eixo Y
    bodyPosition.Position = HumanoidRootPart.Position
    bodyPosition.P = 10000
    bodyPosition.D = 500
    bodyPosition.Parent = HumanoidRootPart
    
    -- Loop de voo
    local lastPrint = 0
    while isFlying do
        task.wait()
        
        local currentPos = HumanoidRootPart.Position
        local distance = getDistance(currentPos, targetPos)
        
        -- Verificar se chegou
        if distance < 5 then
            print("Chegou ao destino!")
            isFlying = false
            break
        end
        
        -- Calcular direção
        local direction = (targetPos - currentPos).Unit
        
        -- Ajustar velocidade baseada na distância
        local currentSpeed = flySpeed
        if distance > 1000 then
            currentSpeed = flySpeed * 3
        elseif distance > 500 then
            currentSpeed = flySpeed * 2
        elseif distance < 50 then
            currentSpeed = flySpeed * 0.3
        end
        
        -- Atualizar posição do BodyPosition para seguir o movimento
        bodyPosition.Position = currentPos + (direction * 10)
        
        -- Aplicar velocidade
        bodyVelocity.Velocity = direction * currentSpeed
        bodyGyro.CFrame = CFrame.new(currentPos, targetPos)
        
        -- Mostrar progresso
        local distFloor = math.floor(distance)
        if distFloor ~= lastPrint and distFloor % 100 == 0 then
            print("Distância restante: " .. distFloor .. " metros")
            lastPrint = distFloor
        end
    end
    
    -- Limpar objetos de voo
    if bodyVelocity then bodyVelocity:Destroy() end
    if bodyGyro then bodyGyro:Destroy() end
    if bodyPosition then bodyPosition:Destroy() end
    
    -- Desativar noclip
    task.wait(0.1)
    disableNoclip()
    
    -- Parar movimento
    HumanoidRootPart.Velocity = Vector3.new(0, 0, 0)
    HumanoidRootPart.RotVelocity = Vector3.new(0, 0, 0)
    
    -- Teleporte final para posição exata
    task.wait(0.1)
    HumanoidRootPart.CFrame = CFrame.new(targetPos)
    
    task.wait(0.1)
    
    print("Voo concluído!")
end

-- Função principal
local function executeTeleport()
    local currentPos = HumanoidRootPart.Position
    local distance = getDistance(currentPos, targetPosition)
    
    print("==========================================")
    print("Posição destino: " .. tostring(targetPosition))
    print("Distância até o destino: " .. math.floor(distance) .. " metros")
    print("==========================================")
    
    if distance <= maxTeleportDistance then
        -- Teleporte direto
        print("Teleportando diretamente...")
        teleportPlayer(targetPosition)
        print("Teleporte concluído!")
    else
        -- Voar até o destino
        print("Distância muito grande, iniciando voo...")
        flyToTarget(targetPosition)
    end
end

-- EXECUTAR O SCRIPT
executeTeleport()
